<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cache Test - OTC Sports Center</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Cache Manager Test</h1>
        <p class="text-muted">Test the caching functionality for schedule data</p>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Cache Status</h5>
                    </div>
                    <div class="card-body">
                        <div id="cacheStatus">
                            <div class="spinner-border spinner-border-sm" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            Loading cache status...
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Actions</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary me-2" onclick="testCache()">
                            <i class="fas fa-download me-1"></i>Test Cache
                        </button>
                        <button class="btn btn-warning me-2" onclick="forceRefresh()">
                            <i class="fas fa-sync me-1"></i>Force Refresh
                        </button>
                        <button class="btn btn-danger" onclick="clearCache()">
                            <i class="fas fa-trash me-1"></i>Clear Cache
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Test Results</h5>
                    </div>
                    <div class="card-body">
                        <div id="testResults">
                            <p class="text-muted">Click "Test Cache" to see results</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/cache-manager.js"></script>
    
    <script>
        function updateCacheStatus() {
            const statusEl = document.getElementById('cacheStatus');
            if (!window.cacheManager) {
                statusEl.innerHTML = '<div class="text-danger">Cache manager not loaded</div>';
                return;
            }
            
            const status = window.cacheManager.getCacheStatus();
            let html = '<div class="mb-2">';
            
            if (status.hasData) {
                html += `<div class="text-success"><i class="fas fa-check-circle me-1"></i>Data cached</div>`;
                html += `<div class="small text-muted">Age: ${status.ageMinutes} minutes</div>`;
                html += `<div class="small text-muted">Valid: ${status.isValid ? 'Yes' : 'No'}</div>`;
                if (status.lastUpdated) {
                    html += `<div class="small text-muted">Last updated: ${status.lastUpdated.toLocaleString()}</div>`;
                }
            } else {
                html += `<div class="text-warning"><i class="fas fa-exclamation-triangle me-1"></i>No cached data</div>`;
            }
            
            html += '</div>';
            statusEl.innerHTML = html;
        }
        
        async function testCache() {
            const resultsEl = document.getElementById('testResults');
            resultsEl.innerHTML = '<div class="spinner-border spinner-border-sm me-2"></div>Testing cache...';
            
            try {
                const startTime = Date.now();
                const data = await window.cacheManager.getScheduleData();
                const endTime = Date.now();
                const loadTime = endTime - startTime;
                
                resultsEl.innerHTML = `
                    <div class="alert alert-success">
                        <h6><i class="fas fa-check-circle me-1"></i>Cache Test Successful</h6>
                        <p class="mb-1">Load time: ${loadTime}ms</p>
                        <p class="mb-1">Data received: ${data ? 'Yes' : 'No'}</p>
                        <p class="mb-0">Days available: ${data?.days?.length || 0}</p>
                    </div>
                `;
                
                updateCacheStatus();
            } catch (error) {
                resultsEl.innerHTML = `
                    <div class="alert alert-danger">
                        <h6><i class="fas fa-exclamation-triangle me-1"></i>Cache Test Failed</h6>
                        <p class="mb-0">Error: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        async function forceRefresh() {
            const resultsEl = document.getElementById('testResults');
            resultsEl.innerHTML = '<div class="spinner-border spinner-border-sm me-2"></div>Force refreshing...';
            
            try {
                const startTime = Date.now();
                const data = await window.cacheManager.forceRefresh();
                const endTime = Date.now();
                const loadTime = endTime - startTime;
                
                resultsEl.innerHTML = `
                    <div class="alert alert-info">
                        <h6><i class="fas fa-sync me-1"></i>Force Refresh Successful</h6>
                        <p class="mb-1">Load time: ${loadTime}ms</p>
                        <p class="mb-1">Data received: ${data ? 'Yes' : 'No'}</p>
                        <p class="mb-0">Days available: ${data?.days?.length || 0}</p>
                    </div>
                `;
                
                updateCacheStatus();
            } catch (error) {
                resultsEl.innerHTML = `
                    <div class="alert alert-danger">
                        <h6><i class="fas fa-exclamation-triangle me-1"></i>Force Refresh Failed</h6>
                        <p class="mb-0">Error: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        function clearCache() {
            try {
                localStorage.removeItem('otc_schedule_cache');
                localStorage.removeItem('otc_schedule_timestamp');
                
                document.getElementById('testResults').innerHTML = `
                    <div class="alert alert-warning">
                        <h6><i class="fas fa-trash me-1"></i>Cache Cleared</h6>
                        <p class="mb-0">All cached data has been removed</p>
                    </div>
                `;
                
                updateCacheStatus();
            } catch (error) {
                document.getElementById('testResults').innerHTML = `
                    <div class="alert alert-danger">
                        <h6><i class="fas fa-exclamation-triangle me-1"></i>Clear Cache Failed</h6>
                        <p class="mb-0">Error: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(updateCacheStatus, 500);
        });
    </script>
</body>
</html>
